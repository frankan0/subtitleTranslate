# 腾讯云翻译优化说明

## 优化特性

### 1. 智能批量处理
- **短文本合并**：将多个短字幕行合并为一个大文本（最多5000字符），减少API调用次数
- **长文本分割**：超过6000字符的文本自动分割为多个小块处理
- **保持行对应**：翻译结果按换行符分割，确保与原始字幕行一一对应

### 2. 性能优化
- **减少API调用**：通过合并短文本，显著减少API请求次数
- **速率限制**：内置每秒5次请求的速率限制，避免触发API限制
- **并发处理**：支持批量处理，提高翻译效率

### 3. 错误处理
- **回退机制**：批量翻译失败时自动回退到单行翻译
- **参数验证**：严格验证API密钥、语言代码等参数
- **详细日志**：记录翻译过程和错误信息，便于调试

### 4. 使用示例

```go
// 使用新的合并翻译功能
translatedLines, err := tencent.TranslateMergedText(
    "Hello world\nHow are you?\nThis is a test",
    "zh",      // 目标语言
    "en",      // 源语言
    secretId,  // API密钥
    secretKey, // API密钥
    "ap-beijing" // 区域
)
```

### 5. 技术实现

#### 合并策略
- 最大合并长度：5000字符
- 分割阈值：6000字符
- 行分隔符：\n
#### 映射机制
- 记录原始行索引
- 按换行符分割翻译结果
- 确保翻译结果与原始行数匹配

#### 错误恢复
- 批量翻译失败时回退到单行翻译
- 保持翻译结果的完整性
- 提供详细的错误信息

## 性能对比

| 处理方式 | API调用次数 | 处理时间 | 适用场景 |
|---------|------------|----------|----------|
| 单行翻译 | N次 | 较慢 | 少量文本 |
| 合并翻译 | 1次 | 快速 | 大量短文本 |
| 分割翻译 | ceil(N/6)次 | 中等 | 长文本 |

## 注意事项

1. **文本长度**：单条字幕建议不超过6000字符
2. **语言支持**：支持所有腾讯云翻译支持的语言
3. **API限制**：遵守腾讯云API的速率和用量限制
4. **错误处理**：建议实现重试机制和备用翻译方案